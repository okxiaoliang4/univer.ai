import Image from 'next/image'
import missingLocaleImg from './troubleshooting/missing-locale.png'

# å¸¸è§é—®é¢˜

## å®‰è£…ç›¸å…³

### ä¸ºä»€ä¹ˆæˆ‘åœ¨ä½¿ç”¨ webpack 4 çš„é¡¹ç›®ä¸­å¯¼å…¥ Univer ä¼šæŠ¥é”™ï¼Ÿ

- webpack 4 æ— æ³•æ­£ç¡®åœ°è¯†åˆ« `packages.json` çš„ `exports` å­—æ®µï¼Œè¯¦è§ [webpack/webpack#9509](https://github.com/webpack/webpack/issues/9509)ã€‚
ä½ éœ€è¦æ‰¾åˆ°æ­£ç¡®è·¯å¾„å¹¶æ‰‹åŠ¨å¼•å…¥ã€‚éƒ¨åˆ†ç¬¬ä¸‰æ–¹ä¾èµ–å¯èƒ½éœ€è¦é€šè¿‡é…ç½® `resolve.alias` å»ºç«‹åˆ«åæ¥è§£å†³ã€‚
- åœ¨æŸäº› webpack 4 è„šæ‰‹æ¶ä¸­ï¼Œé»˜è®¤çš„ babel çš„é…ç½®å¯èƒ½ä¸å¤„ç† node_modules ä¸‹çš„ä¾èµ–ï¼Œä½ å¯èƒ½éœ€è¦æ‰‹åŠ¨ä¿®æ”¹ webpack çš„ rulesï¼Œå°† `@univerjs/*` æ·»åŠ åˆ° babel-loader çš„ `include` é…ç½®ä¸­ã€‚

æˆ‘ä»¬æä¾›äº†ä¸€ä¸ªåŸºäº webpack 4 çš„[åœ¨çº¿ demo](/playground?title=Webpack%204)ï¼Œå¸Œæœ›å¯ä»¥å¸®åŠ©ä½ è§£å†³è¿™ä¸ªé—®é¢˜

### ä¸ºä»€ä¹ˆä½¿ç”¨ `<script>` å¼•å…¥ Univer UMD åŒ…æ—¶ï¼Œéƒ¨åˆ†æ’ä»¶æ³¨å†Œæ—¶ä¼šæŠ¥é”™ï¼Ÿ

- è¯·ç¡®ä¿ä½ æŒ‰é¡ºåºå¼•å…¥äº†æ’ä»¶æ‰€ç”¨åˆ°çš„å‰ç½®ä¾èµ–ã€‚
- å¯åœ¨æ’ä»¶çš„æ–‡æ¡£é¡µæˆ–æ’ä»¶æºç çš„ `packages.json` çš„ `peerDependencies` å­—æ®µä¸­æ‰¾åˆ°æ’ä»¶è¿è¡Œæ‰€éœ€è¦çš„å‰ç½®ä¾èµ–é¡¹ã€‚

### ä¸ºä»€ä¹ˆæˆ‘ä½¿ç”¨ npm æˆ–è€… yarn å®‰è£…ï¼Œè¿è¡Œæ—¶æŠ¥é”™æ‰¾ä¸åˆ°ä¾èµ–ï¼Ÿ

è¿™å¯èƒ½æ˜¯å› ä¸ºä½ ä½¿ç”¨çš„ node åŒ…ç®¡ç†å·¥å…·ç‰ˆæœ¬è¾ƒä½å¯¼è‡´ï¼Œ yarn å’Œ npm@6 ä¸ä¼šè‡ªåŠ¨å®‰è£… `packages.json` ä¸­çš„ `peerDependencies`ï¼Œè¯¦è§ [package-json#peerdependencies](https://docs.npmjs.com/cli/v10/configuring-npm/package-json#peerdependencies)ã€‚

- ä½ å¯ä»¥è‡ªè¡Œå®‰è£…ç¼ºå¤±çš„é™„å±ä¾èµ–é¡¹ã€‚
- å¯¹äº npm ç”¨æˆ·ï¼Œå¯å°† node ç‰ˆæœ¬æ›´æ–°è‡³ 16 ä»¥ä¸Šï¼Œäº¦æˆ–è€…å°† npm ç‰ˆæœ¬å‡çº§è‡³ 7 åŠä»¥ä¸Šï¼Œå¹¶ç•™æ„å‡çº§è¡Œä¸ºå¯èƒ½å¯¹ä½ å·²æœ‰é¡¹ç›®çš„å½±å“ã€‚

## å¼€å‘ç›¸å…³

### ä¸ºä»€ä¹ˆæˆ‘çš„èœå•é¡¹ä¸­æ²¡æœ‰æ˜¾ç¤ºæ­£ç¡®çš„è¯­è¨€ï¼Ÿ

è¿™æ˜¯å› ä¸ºä½ é—æ¼äº†å¯¹åº”çš„è¯­è¨€åŒ…ï¼Œä½ éœ€è¦åœ¨åˆå§‹åŒ– Univer æ—¶ä¼ å…¥å¯¹åº”çš„è¯­è¨€åŒ…ï¼Œè¯¦æƒ…è¯·å‚è€ƒå„ä¸ªåŠŸèƒ½é¡¹ä¸­å›½é™…åŒ–ç›¸å…³çš„æ–‡æ¡£ã€‚

<Image src={missingLocaleImg} alt="Missing Locale" width={300} />

### ğŸ“Š å¦‚ä½•å®æ—¶è·å–å•å…ƒæ ¼ç¼–è¾‘å™¨å†…çš„æ•°æ®ï¼Ÿ

Univer Sheet çš„å•å…ƒæ ¼ç¼–è¾‘å™¨æœ¬è´¨ä¸Šå°±æ˜¯ Univer Doc çš„ç¼–è¾‘å™¨ï¼Œå› æ­¤ä½ å¯ä»¥é€šè¿‡ Facade API è·å–å½“å‰æ¿€æ´»çš„ Univer Doc ç¼–è¾‘å™¨å†…çš„ snapshot æ•°æ®ã€‚

```typescript
univerAPI.onCommandExecuted((command) => {
  const { id } = command;
  if (id === 'doc.command.insert-text' || id === 'doc.command.delete-text') {
    const doc = univerAPI.getActiveDocument();
    if (doc) {
      const snapshot = doc.getSnapshot();
      console.log(snapshot.body?.dataStream);
    }
  }
});
```

å‚è€ƒï¼šhttps://github.com/dream-num/univer/discussions/2261

### ğŸ“Š å•å…ƒæ ¼ç¼–è¾‘å™¨èšç„¦æ—¶ç‚¹å‡»å¤–éƒ¨æŒ‰é’®è§¦å‘äº‹ä»¶ï¼Œè·å–çš„ snapshot ä¸­æœªåŒ…å«è¯¥èšç„¦å•å…ƒæ ¼çš„æ•°æ®

å•å…ƒæ ¼çš„æ•°æ®ä¼šåœ¨å¤±ç„¦æ—¶åŒæ­¥åˆ° snapshot ä¸­ï¼Œå› æ­¤ä½ åº”å½“åœ¨è·å– snapshot æ•°æ®å‰å…ˆå¯¹å•å…ƒæ ¼è¿›è¡Œå¤±ç„¦æ“ä½œã€‚

```typescript
import { DeviceInputEventType } from '@univerjs/engine-render';
import { FUniver } from '@univerjs/facade';

const univerAPI = FUniver.newAPI(univer);

$btn.addEventListener('click', () => {
  univerAPI.executeCommand('sheet.operation.set-cell-edit-visible', {
    visible: false,
    _eventType: DeviceInputEventType.PointerUp,
  });
});
```

å‚è€ƒï¼šhttps://github.com/dream-num/univer/issues/1314

### univerä¼šæ”¶é›†æˆ‘çš„æ•°æ®å—ï¼Ÿ
univer ä¼šæ”¶é›†ç”¨æˆ·ä¸å¹³å°äº¤äº’çš„æ•°æ®ã€‚è¿™äº›æ•°æ®å¸®åŠ© univer å›¢é˜Ÿè¯†åˆ«ä½¿ç”¨æ¨¡å¼ã€è§£å†³é—®é¢˜ï¼Œå¹¶å°±æ–°åŠŸèƒ½å’Œæ”¹è¿›åšå‡ºæ˜æ™ºçš„å†³ç­–ã€‚

éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œuniver ä¸ä¼šæ•è·æ‚¨çš„ APIã€æ•°æ®åº“æˆ–ç¬¬ä¸‰æ–¹å·¥å…·è¿”å›çš„ä»»ä½•æ•°æ®ã€‚å¯¹äºç§æœ‰åŒ–éƒ¨ç½²çš„å®ä¾‹ï¼Œæ‰€æœ‰æ”¶é›†çš„æ•°æ®éƒ½æ˜¯å®Œå…¨åŒ¿åçš„ï¼Œä»¥ç¡®ä¿ç”¨æˆ·ä¿¡æ¯çš„å®‰å…¨ã€‚

å¦‚æœæ‚¨å¸Œæœ›ç¦ç”¨æ•°æ®æ”¶é›†åŠŸèƒ½ï¼Œå¯ä»¥æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤æ“ä½œï¼š

1. è¿›å…¥`docker-compose/configs`ç›®å½•ï¼Œ
2. åˆ é™¤`verify.json`æ–‡ä»¶å³å¯

## é›†æˆç›¸å…³

### ä½¿ç”¨ React

é¦–å…ˆè¯·ç¡®ä¿ä½ çš„ React ç‰ˆæœ¬åœ¨ 16.9 ä»¥ä¸Šï¼Œå› ä¸º Univer çš„ UI å±‚ä¾èµ– Reactï¼Œå¹¶ä¸”ä½¿ç”¨äº† React Hooksã€‚

æ­¤å¤–ï¼Œå—é™äº Univer DI æœºåˆ¶ï¼Œæš‚æ—¶ä¸æ”¯æŒ React çš„ StrictModeï¼Œé€šè¿‡ç§»é™¤ StrictMode å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚

```diff
- <React.StrictMode>
  <App />
- </React.StrictMode>
```

### ä½¿ç”¨ Angular

ä½¿ç”¨ Angular CLI é»˜è®¤åˆ›å»ºçš„é¡¹ç›®æ¨¡æ¿å¼•å…¥ Univer å‰éœ€è¦ç¡®ä¿æ˜¯å¦åœ¨ `tsconfig.json` ä¸­é…ç½®äº† `"skipLibCheck": true`ï¼š

```diff
{
  "compilerOptions": {
+    "skipLibCheck": true
  }
}
```

## æ•…éšœæ’æŸ¥

### Error: [ThemeService]: current theme is not set!

```
Error: [ThemeService]: current theme is not set!
```

å‡ºç°è¯¥é”™è¯¯çš„åŸå› æ˜¯å› ä¸ºä½ åœ¨ä½¿ç”¨ Univer æ—¶æ²¡æœ‰è®¾ç½®ä¸»é¢˜ã€‚ä½ éœ€è¦é€šè¿‡ä»¥ä¸‹æ–¹å¼æ¥è®¾ç½®ä¸»é¢˜ï¼š

```typescript {2}
const univer = new Univer({
  theme: defaultTheme,
  locale: LocaleType.ZH_CN,
  locales: {
      [LocaleType.ZH_CN]: zhCN,
  },
});
```

### Error: [LocaleService]: Locale not initialized

```
Error: [LocaleService]: Locale not initialized
```

å‡ºç°è¯¥é”™è¯¯çš„åŸå› æ˜¯å› ä¸ºä½ åœ¨ä½¿ç”¨ Univer æ—¶æ²¡æœ‰åˆå§‹åŒ–è¯­è¨€ç¯å¢ƒã€‚ä½ éœ€è¦é€šè¿‡ä»¥ä¸‹æ–¹å¼æ¥åˆå§‹åŒ–è¯­è¨€ç¯å¢ƒï¼š

```typescript {3-6}
const univer = new Univer({
  theme: defaultTheme,
  locale: LocaleType.ZH_CN,
  locales: {
      [LocaleType.ZH_CN]: zhCN,
  },
});
```
